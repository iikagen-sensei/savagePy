{% extends "ui/base.html" %}

{% block title %}Reglas Â· Savage Worlds{% endblock %}

{% block body %}
<div class="hero">
  <div class="hero-inner">
    <div class="hero-eyebrow">Reglas modulares</div>
    <h1>Compendio<br>de <strong>normas</strong></h1>
  </div>
</div>

<main class="sw-main">
  <div class="list-head">
    <span class="list-head-title">{{ rules|length }} regla{{ 's' if rules|length != 1 }}</span>
    <a href="/rules/new" class="btn btn-solid">+ Nueva regla</a>
  </div>

  {% if rules %}
  <div class="rules-list">
    {% for rule in rules %}
    {% set rid = rule.id|default(rule.Id) %}
    <div class="rule-row">
      <div class="rule-icon">{{ rule.icon or 'ðŸ“œ' }}</div>
      <div class="rule-info">
        <div class="rule-name">
          {{ rule.name }}
          {% if rule.name_original %}<span class="rule-original">({{ rule.name_original }})</span>{% endif %}
          <span class="rule-source rule-source--{{ rule.source|lower|replace(' ','') }}">{{ rule.source or '' }}</span>
        </div>
        <div class="rule-desc">{{ rule.description or 'â€”' }}</div>
      </div>
      <div class="rule-actions">
        <a href="/rules/{{ rid }}/edit" class="btn btn-outline">Editar</a>
        <button class="btn btn-red btn-del" onclick="confirmDelete({{ rid }}, '{{ rule.name }}')">âœ•</button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div style="text-align:center; padding:4rem 2rem; color:var(--muted);">
    <div style="font-size:3rem; margin-bottom:1rem; opacity:0.3;">âš–</div>
    <div style="font-family:'Cinzel',serif; font-size:1.1rem; margin-bottom:0.5rem;">Sin reglas todavÃ­a</div>
    <div style="font-style:italic; margin-bottom:1.5rem;">AÃ±ade la primera regla modular.</div>
    <a href="/rules/new" class="btn btn-solid">+ Nueva regla</a>
  </div>
  {% endif %}
</main>

<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>Eliminar regla</h3>
    <p id="modalMsg">Â¿Seguro que quieres eliminar esta regla?</p>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
      <form id="deleteForm" method="POST" style="display:inline">
        <button type="submit" class="btn btn-red">Eliminar</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function confirmDelete(id, name) {
    document.getElementById('modalMsg').textContent = 'Â¿Seguro que quieres eliminar "' + name + '"? Esta acciÃ³n no se puede deshacer.';
    document.getElementById('deleteForm').action = '/rules/' + id + '/delete';
    document.getElementById('modalBg').classList.add('active');
  }
  function closeModal() { document.getElementById('modalBg').classList.remove('active'); }
  document.getElementById('modalBg').addEventListener('click', function(e) { if(e.target===this) closeModal(); });
</script>
{% endblock %}
